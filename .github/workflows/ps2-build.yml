name: Build PS2 Homebrew

on: [push, workflow_dispatch]

jobs:
  build-ps2:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Build PS2 ELF
      run: |
        echo "üî® Compilando para PS2..."
        
        # Usa /bin/sh que SEMPRE existe
        docker run --rm -v $(pwd):/workspace -w /workspace \
          ps2dev/ps2dev \
          /bin/sh -c "ee-gcc -O2 -G0 -Wall -o hello_world.elf main.c -lc -lkernel -lsifrpc -ldebug"
        
    - name: Verificar resultado
      run: |
        if [ -f "hello_world.elf" ]; then
          echo "‚úÖ SUCESSO: hello_world.elf gerado!"
          file hello_world.elf
        else
          echo "‚ùå FALHA: ELF n√£o foi gerado"
          exit 1
        fi
        
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: ps2-elf
        path: hello_world.elf
