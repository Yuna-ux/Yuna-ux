name: Build PS2 Homebrew

on: [push, workflow_dispatch]

jobs:
  build-ps2:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Build PS2 ELF
      run: |
        echo "üî® Compilando para PS2..."
        
        # Baixa toolchain pr√©-compilado
        docker run --rm -v $(pwd):/workspace -w /workspace ubuntu:22.04 \
          bash -c "
            apt-get update && apt-get install -y wget xz-utils &&
            wget https://github.com/ps2dev/ps2toolchain/releases/latest/download/ps2dev.tar.xz -O /tmp/ps2dev.tar.xz &&
            tar -xf /tmp/ps2dev.tar.xz -C /usr/local/ &&
            export PATH=/usr/local/ps2dev/ee/bin:/usr/local/ps2dev/iop/bin:/usr/local/ps2dev/dvp/bin:$PATH &&
            ee-gcc -O2 -G0 -Wall -o hello_world.elf main.c -lc -lkernel -lsifrpc -ldebug
          "
        
    - name: Verificar resultado
      run: |
        if [ -f "hello_world.elf" ]; then
          echo "‚úÖ SUCESSO: hello_world.elf gerado!"
          file hello_world.elf
        else
          echo "‚ùå FALHA: ELF n√£o foi gerado"
          exit 1
        fi
        
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: ps2-elf
        path: hello_world.elf
