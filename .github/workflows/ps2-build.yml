name: Build PS2 Homebrew

on: [push, workflow_dispatch]

jobs:
  build-ps2:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Build PS2 ELF
      run: |
        echo "üî® Compilando para PS2..."
        
        # Usa Ubuntu normal e instala ps2dev manualmente
        docker run --rm -v $(pwd):/workspace -w /workspace ubuntu:22.04 \
          bash -c "
            apt-get update && apt-get install -y git build-essential wget &&
            git clone https://github.com/ps2dev/ps2dev.git /tmp/ps2dev &&
            cd /tmp/ps2dev &&
            ./build-all.sh &&
            /usr/local/ps2dev/ee/bin/ee-gcc -O2 -G0 -Wall -o /workspace/hello_world.elf /workspace/main.c -lc -lkernel -lsifrpc -ldebug
          "
        
    - name: Verificar resultado
      run: |
        if [ -f "hello_world.elf" ]; then
          echo "‚úÖ SUCESSO: hello_world.elf gerado!"
          file hello_world.elf
        else
          echo "‚ùå FALHA: ELF n√£o foi gerado"
          exit 1
        fi
        
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: ps2-elf
        path: hello_world.elf
